<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stone Clicker Game - Debug Fix</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #instruction {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        #clickCountParagraph {
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        #stoneImage {
            cursor: pointer;
            width: 150px;
            max-width: 80%;
            height: auto;
            border: 2px solid black;
            border-radius: 10px;
            margin-bottom: 20px;
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            transition: transform 0.1s; /* ã‚¿ãƒƒãƒ—æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å°‘ã—æ—©ã */
        }
        #stoneImage:active {
            transform: scale(0.95);
        }
        #myVideo {
            display: none;
            width: 90%;
            max-width: 800px;
            margin-top: 10px;
            background-color: #000;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <div id="contentWrapper" class="content-wrapper">
        <p id="instruction">çŸ³ã‚’100å›ã‚¿ãƒƒãƒ—ã—ã¦ï¼</p>
        <p id="clickCountParagraph">ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ãƒˆ: <span id="clickCountDisplay">0</span> / 100</p>
        <img src="stone.png" id="stoneImage" alt="Click the Stone!">
    </div>

    <video id="myVideo">
        <source src="D4372235-B49A-41E0-B864-C3957B4F8A9E.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <script>
        const stoneImage = document.getElementById('stoneImage');
        const videoPlayer = document.getElementById('myVideo');
        const clickCountDisplay = document.getElementById('clickCountDisplay');
        const instructionText = document.getElementById('instruction');
        const clickCountParagraph = document.getElementById('clickCountParagraph');
        const contentWrapper = document.getElementById('contentWrapper');

        // ãƒ‡ãƒãƒƒã‚°ç”¨: è¦ç´ ãŒæ­£ã—ãå–å¾—ã§ãã¦ã„ã‚‹ã‹ç¢ºèª
        console.log('stoneImage element:', stoneImage);
        console.log('clickCountDisplay element:', clickCountDisplay);
        console.log('contentWrapper element:', contentWrapper);


        let clicks = 0;
        const clicksForVideo = 50;
        const totalClicksGoal = 100;
        let videoHasPlayed = false;

        if (stoneImage) { // stoneImageãŒå–å¾—ã§ãã¦ã„ã‚‹å ´åˆã®ã¿ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            stoneImage.addEventListener('click', function() {
                console.log('Stone image clicked!'); // â˜…ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã‹ç¢ºèª
                console.log('Current clicks value BEFORE increment:', clicks);
                console.log('totalClicksGoal value:', totalClicksGoal);

                if (clicks < totalClicksGoal) {
                    clicks++;
                    console.log('Clicks incremented to:', clicks); // â˜…ã‚«ã‚¦ãƒ³ãƒˆãŒå¢—ãˆãŸã‹ç¢ºèª
                    if (clickCountDisplay) {
                        clickCountDisplay.textContent = clicks;
                    } else {
                        console.error('ERROR: clickCountDisplay element is NOT found!');
                    }
                } else {
                    console.log('Max clicks reached. Not incrementing.');
                }

                // 50å›ã‚¯ãƒªãƒƒã‚¯ã§å‹•ç”»å†ç”Ÿ
                if (clicks >= clicksForVideo && !videoHasPlayed) {
                    console.log('50 Clicks reached. Hiding contentWrapper. Preparing video.');
                    if(contentWrapper) contentWrapper.classList.add('hidden');

                    videoPlayer.style.display = 'block';
                    videoPlayer.volume = 1.0;

                    if (videoPlayer.requestFullscreen) {
                        videoPlayer.requestFullscreen().catch(err => console.error("Error attempting fullscreen:", err));
                    } else if (videoPlayer.mozRequestFullScreen) {
                        videoPlayer.mozRequestFullScreen().catch(err => console.error("Error attempting fullscreen (Firefox):", err));
                    } else if (videoPlayer.webkitRequestFullscreen) {
                        videoPlayer.webkitRequestFullscreen().catch(err => console.error("Error attempting fullscreen (WebKit):", err));
                    } else if (videoPlayer.msRequestFullscreen) {
                        videoPlayer.msRequestFullscreen().catch(err => console.error("Error attempting fullscreen (MS):", err));
                    }

                    videoPlayer.play()
                        .then(() => {
                            console.log("Video started playing.");
                        })
                        .catch(error => {
                            console.error("Error attempting to play video:", error);
                            if(contentWrapper) contentWrapper.classList.remove('hidden');
                            if(instructionText) instructionText.textContent = "å‹•ç”»ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
                        });
                    videoHasPlayed = true;
                }

                // 100å›é”æˆæ™‚ã®å‡¦ç†
                if (clicks >= totalClicksGoal && videoHasPlayed) {
                    if(instructionText) instructionText.textContent = "100å›é”æˆï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ğŸ‰";
                    if(clickCountParagraph) clickCountParagraph.textContent = "ç´ æ™´ã‚‰ã—ã„ï¼";
                    console.log("100 clicks and video played. Final message set.");
                    if (contentWrapper && contentWrapper.classList.contains('hidden')) {
                        contentWrapper.classList.remove('hidden');
                    }
                    if(videoPlayer) videoPlayer.style.display = 'none';
                } else if (clicks >= totalClicksGoal && !videoHasPlayed) {
                    if(instructionText) instructionText.textContent = "100å›é”æˆï¼ (å‹•ç”»ã¯50å›ã§å†ç”Ÿã®ã¯ãšã§ã—ãŸ)";
                    if (contentWrapper && contentWrapper.classList.contains('hidden')) {
                        contentWrapper.classList.remove('hidden');
                    }
                }
            });
        } else {
            console.error('ERROR: stoneImage element is NOT found! Click events will not work.');
        }


        function handleFullscreenChange() {
            if (!document.fullscreenElement && !document.webkitIsFullScreen && !document.mozFullScreen && !document.msFullscreenElement) {
                console.log("Exited fullscreen mode.");
                if (contentWrapper && contentWrapper.classList.contains('hidden')) {
                     contentWrapper.classList.remove('hidden');
                }
                if (instructionText && videoHasPlayed && clicks < totalClicksGoal) {
                     instructionText.textContent = "å‹•ç”»çµ‚äº†ã€‚ç¶šã‘ã¦100å›ã‚’ç›®æŒ‡ãã†ï¼";
                }
            } else {
                console.log("Entered fullscreen mode.");
            }
        }

        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);

        if (videoPlayer) { // videoPlayerãŒå–å¾—ã§ãã¦ã„ã‚‹å ´åˆã®ã¿ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            videoPlayer.addEventListener('ended', () => {
                console.log("Video has ended.");
                if (document.fullscreenElement || document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement) {
                    document.exitFullscreen().catch(err => console.log("Error exiting fullscreen on video end:",err));
                }
                
                if (contentWrapper && contentWrapper.classList.contains('hidden')) {
                    contentWrapper.classList.remove('hidden');
                }

                if (instructionText && clicks < totalClicksGoal) {
                    instructionText.textContent = "å‹•ç”»çµ‚äº†ã€‚ç¶šã‘ã¦100å›ã‚’ç›®æŒ‡ãã†ï¼";
                } else if (instructionText && clickCountParagraph) { // 100å›é”æˆæ¸ˆã¿ã§å‹•ç”»çµ‚äº†
                    instructionText.textContent = "100å›é”æˆï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼";
                    clickCountParagraph.textContent = "ç´ æ™´ã‚‰ã—ã„ï¼";
                }
                if(videoPlayer) videoPlayer.style.display = 'none';
            });
        } else {
            console.error('ERROR: videoPlayer element is NOT found! Video events will not work.');
        }
    </script>

</body>
</html>
