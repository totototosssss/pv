<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> {/* ã“ã®è¡Œã¯é‡è¦ã§ã™ */}
    <title>Stone Clicker Game - Mobile Fix</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.5s;
        }
        .content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #instruction {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        #clickCountParagraph {
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        #stoneImage {
            cursor: pointer;
            width: 150px; /* ã‚¹ãƒãƒ›ã§ã®ã‚¿ãƒƒãƒ—ã—ã‚„ã™ã•ã‚’è€ƒãˆã¦ã€å°‘ã—å¤§ãã‚ã«ã—ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ */
            max-width: 80%;
            height: auto;
            border: 2px solid black;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: opacity 0.3s, transform 0.3s;
            user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚‚é˜²ãï¼ˆã‚¿ãƒƒãƒ—ã®é‚ªé­”ã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ï¼‰ */
            -webkit-user-select: none; /* Safariç”¨ */
            -ms-user-select: none; /* IEç”¨ */
            touch-action: manipulation; /* â˜…â˜…â˜… ã“ã‚ŒãŒé‡è¦ã§ã™ï¼ â˜…â˜…â˜… */
            -webkit-tap-highlight-color: transparent; /* ã‚¿ãƒƒãƒ—æ™‚ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆè‰²ã‚’é€æ˜ã« */
        }
        #stoneImage:hover { /* PCã§ã®ãƒ›ãƒãƒ¼åŠ¹æœ */
            opacity: 0.8;
            transform: scale(1.05);
        }
        /* ã‚¹ãƒãƒ›ã§ :active ã‚’ä½¿ã†ã¨ã‚¿ãƒƒãƒ—æ„Ÿã‚’å‡ºã›ã‚‹å ´åˆãŒã‚ã‚‹ */
        #stoneImage:active {
            transform: scale(0.95); /* ã‚¿ãƒƒãƒ—æ™‚ã«å°‘ã—å°ã•ããªã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
            opacity: 0.7;
        }
        #myVideo {
            display: none;
            width: 90%;
            max-width: 800px;
            margin-top: 10px;
            background-color: #000;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <div id="contentWrapper" class="content-wrapper">
        <p id="instruction">ç ”ä¸€ã‚’100å›ã‚¿ãƒƒãƒ—ã—ã¦ï¼</p>
        <p id="clickCountParagraph">ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ãƒˆ: <span id="clickCountDisplay">0</span> / 100</p>
        <img src="stone.png" id="stoneImage" alt="Click the Stone!">
    </div>

    <video id="myVideo">
        <source src="D4372235-B49A-41E0-B864-C3957B4F8A9E.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    {/* JavaScriptéƒ¨åˆ†ã¯å‰å›ã®ãƒ­ã‚°è¿½åŠ ç‰ˆã¨åŒã˜ãªã®ã§çœç•¥ã—ã¾ã™ã€‚å¤‰æ›´ã¯<style>å†…ã®ã¿ã§ã™ã€‚ */}
    <script>
        const stoneImage = document.getElementById('stoneImage');
        const videoPlayer = document.getElementById('myVideo');
        const clickCountDisplay = document.getElementById('clickCountDisplay');
        const instructionText = document.getElementById('instruction');
        const clickCountParagraph = document.getElementById('clickCountParagraph');
        const contentWrapper = document.getElementById('contentWrapper');

        let clicks = 0;
        const clicksForVideo = 30;
        const totalClicksGoal = 100;
        let videoHasPlayed = false;

        stoneImage.addEventListener('click', function() {
            // console.log("LOG: Stone clicked. Current clicks variable:", clicks);

            if (clicks < totalClicksGoal) {
                clicks++;
                clickCountDisplay.textContent = clicks;
                // console.log("LOG: Counter updated to:", clicks);
            } else {
                // console.log("LOG: Max clicks (100) reached or exceeded. Not incrementing.");
            }

            if (clicks >= clicksForVideo && !videoHasPlayed) {
                // console.log("LOG: 50 Clicks. Hiding contentWrapper. Preparing video.");
                contentWrapper.classList.add('hidden');

                videoPlayer.style.display = 'block';
                videoPlayer.volume = 1.0;

                if (videoPlayer.requestFullscreen) {
                    videoPlayer.requestFullscreen().catch(err => {
                        console.error("Error attempting fullscreen:", err);
                    });
                } else if (videoPlayer.mozRequestFullScreen) {
                    videoPlayer.mozRequestFullScreen().catch(err => console.error("Error attempting fullscreen (Firefox):", err));
                } else if (videoPlayer.webkitRequestFullscreen) {
                    videoPlayer.webkitRequestFullscreen().catch(err => console.error("Error attempting fullscreen (WebKit):", err));
                } else if (videoPlayer.msRequestFullscreen) {
                    videoPlayer.msRequestFullscreen().catch(err => console.error("Error attempting fullscreen (MS):", err));
                }

                videoPlayer.play()
                    .then(() => {
                        // console.log("LOG: Video started playing.");
                    })
                    .catch(error => {
                        console.error("Error attempting to play video:", error);
                        // console.log("LOG: Video play error. Removing 'hidden' from contentWrapper.");
                        contentWrapper.classList.remove('hidden');
                        instructionText.textContent = "å‹•ç”»ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
                    });
                videoHasPlayed = true;
            }

            if (clicks >= totalClicksGoal && videoHasPlayed) {
                instructionText.textContent = "100å›é”æˆï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ğŸ‰";
                clickCountParagraph.textContent = "ç´ æ™´ã‚‰ã—ã„ï¼";
                // console.log("LOG: 100 clicks and video played. Final message set.");
                if (contentWrapper.classList.contains('hidden')) {
                    // console.log("LOG: 100 clicks. Removing 'hidden' from contentWrapper.");
                    contentWrapper.classList.remove('hidden');
                }
                videoPlayer.style.display = 'none';
            } else if (clicks >= totalClicksGoal && !videoHasPlayed) {
                 instructionText.textContent = "100å›é”æˆï¼ (å‹•ç”»ã¯50å›ã§å†ç”Ÿã®ã¯ãšã§ã—ãŸ)";
                 if (contentWrapper.classList.contains('hidden')) {
                    contentWrapper.classList.remove('hidden');
                 }
            }
        });

        function handleFullscreenChange() {
            if (!document.fullscreenElement && !document.webkitIsFullScreen && !document.mozFullScreen && !document.msFullscreenElement) {
                // console.log("LOG: Exited fullscreen mode.");
                if (!contentWrapper.classList.contains('hidden') && videoPlayer.paused && videoHasPlayed) {
                    // Already visible and video paused
                } else if (contentWrapper.classList.contains('hidden')) {
                    //  console.log("LOG: Exited fullscreen. Removing 'hidden' from contentWrapper.");
                     contentWrapper.classList.remove('hidden');
                }

                if (videoHasPlayed && clicks < totalClicksGoal) {
                     instructionText.textContent = "å‹•ç”»çµ‚äº†ã€‚ç¶šã‘ã¦100å›ã‚’ç›®æŒ‡ãã†ï¼";
                }
            } else {
                // console.log("LOG: Entered fullscreen mode.");
            }
        }

        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);

        videoPlayer.addEventListener('ended', () => {
            // console.log("LOG: Video has ended.");
            if (document.fullscreenElement || document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement) {
                document.exitFullscreen().catch(err => console.log("LOG: Error exiting fullscreen on video end:",err));
            }
            
            if (contentWrapper.classList.contains('hidden')) {
                // console.log("LOG: Video ended. Removing 'hidden' from contentWrapper.");
                contentWrapper.classList.remove('hidden');
            }

            if (clicks < totalClicksGoal) {
                instructionText.textContent = "å‹•ç”»çµ‚äº†ã€‚ç¶šã‘ã¦100å›ã‚’ç›®æŒ‡ãã†ï¼";
            } else {
                instructionText.textContent = "100å›é”æˆï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼";
                clickCountParagraph.textContent = "ç´ æ™´ã‚‰ã—ã„ï¼";
            }
            videoPlayer.style.display = 'none';
        });
    </script>

</body>
</html>
